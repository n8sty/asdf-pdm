#!/usr/bin/env bash

set -Eeuo pipefail

trap cleanup SIGINT SIGTERM ERR

cleanup() {
  trap - SIGINT SIGTERM ERR
  echo
  echo "Cleanup: Something went wrong!"
  echo
  echo "$(caller): ${BASH_COMMAND}"
}

if [ "${ASDF_INSTALL_TYPE:-}" != "version" ]; then
	fail "asdf-pdm supports version (eg: 1.2.3) installs only"
fi

flags=()

if test -n "${ASDF_INSTALL_PATH-}"; then
  fail "asdf-pdm only supports installing to PDM's default installation location"
fi

if test -n "${ASDF_INSTALL_VERSION-}"; then
  flags+=("-v ${ASDF_INSTALL_VERSION}")
fi

curl -sSL https://raw.githubusercontent.com/pdm-project/pdm/main/install-pdm.py | python3 - "${flags[@]}"
